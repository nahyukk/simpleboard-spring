<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ğŸ“Œ ê²Œì‹œê¸€ ìƒì„¸</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
</head>
<body>
<div class="container mt-4">
    <section>
        <!-- âœ… ê²Œì‹œê¸€ ì •ë³´ -->
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <a th:href="@{/posts}" class="btn btn-outline-secondary">â¬… ëŒì•„ê°€ê¸°</a>
            </div>
            <div class="d-flex align-items-center">
                <small class="text-secondary me-2">#<span th:text="${post.id}"></span></small>
                <h2 th:text="${post.title}" class="mb-0"></h2>
            </div>
            <div>
                <a th:href="@{/posts/{id}/edit(id=${post.id})}" class="btn btn-warning">âœï¸ ìˆ˜ì •</a>
                <form th:action="@{/posts/{id}/delete(id=${post.id})}" method="post" style="display: inline;">
                    <input type="hidden" name="_method" value="delete"/>
                    <button type="submit" class="btn btn-danger">ğŸ—‘ ì‚­ì œ</button>
                </form>
            </div>
        </div>

        <hr/>
        <p th:text="${post.content}" class="border p-3"></p>
    </section>
    <section>
        <h3>ğŸ’¬ ëŒ“ê¸€</h3>

        <!-- âœ… ëŒ“ê¸€ ì…ë ¥ í¼ (ìƒˆ ëŒ“ê¸€ ì‘ì„±) -->
        <form th:action="@{/posts/{id}/comments(id=${post.id})}" method="post" id="commentForm">
            <div class="mb-3">
                <textarea name="content" id="commentContent" class="form-control" placeholder="ëŒ“ê¸€ ì…ë ¥"
                          required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">ëŒ“ê¸€ ì‘ì„±</button>
        </form>

        <hr/>

        <!-- âœ… ëŒ“ê¸€ ëª©ë¡ -->
        <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center"
                th:each="comment : ${post.comments}" th:id="'comment-' + ${comment.id}">

                <!-- âœ… ê¸°ë³¸ ìƒíƒœ: ëŒ“ê¸€ ë‚´ìš© í‘œì‹œ -->
                <span th:text="${comment.content}" th:id="'comment-text-' + ${comment.id}"></span>

                <div>
                    <!-- âœ… ìˆ˜ì • ë²„íŠ¼ -->
                    <button type="button" class="btn btn-sm btn-secondary"
                            th:data-comment-id="${comment.id}"
                            th:data-comment-content="${comment.content}"
                            th:data-post-id="${post.id}"
                            onclick="editComment(this)">
                        âœï¸ ìˆ˜ì •
                    </button>

                    <!-- âœ… ì‚­ì œ í¼ -->
                    <form th:action="@{/posts/{postId}/comments/{commentId}/delete(postId=${post.id}, commentId=${comment.id})}"
                          method="post" style="display: inline;">
                        <input type="hidden" name="_method" value="delete"/>
                        <button type="submit" class="btn btn-sm btn-danger">ğŸ—‘ ì‚­ì œ</button>
                    </form>
                </div>
            </li>
        </ul>
    </section>
</div>
</body>

<!-- âœ… ëŒ“ê¸€ ìˆ˜ì •ìš© JavaScript -->
<script th:inline="javascript">
    function editComment(button) {
        let commentId = button.getAttribute("data-comment-id");
        let content = button.getAttribute("data-comment-content");
        let postId = button.getAttribute("data-post-id");

        let commentText = document.getElementById("comment-text-" + commentId);
        let commentItem = document.getElementById("comment-" + commentId);

        // âœ… ê¸°ì¡´ ëŒ“ê¸€ ìˆ¨ê¸°ê¸°
        commentText.style.display = "none";

        // âœ… ìˆ˜ì • í¼ ì‚½ì…
        let editForm = `
            <form action="/posts/${postId}/comments/${commentId}/edit" method="post">
                <div class="mb-3">
                    <textarea name="content" class="form-control">${content}</textarea>
                </div>
                <button type="submit" class="btn btn-success">âœ” ì €ì¥</button>
                <button type="button" class="btn btn-secondary" onclick="cancelEdit('${commentId}', '${content}', '${postId}')">ì·¨ì†Œ</button>
            </form>
        `;

        // âœ… ê¸°ì¡´ ëŒ“ê¸€ì„ ìˆ˜ì • í¼ìœ¼ë¡œ êµì²´
        commentItem.innerHTML = editForm;
    }

    // âœ… ì·¨ì†Œ ê¸°ëŠ¥ ì¶”ê°€
function cancelEdit(commentId, content, postId) {
    let commentItem = document.getElementById("comment-" + commentId);

    // âœ… ì›ë˜ ëŒ“ê¸€ UI ë³µì›
    commentItem.innerHTML = `
        <span id="comment-text-${commentId}">${content}</span>
        <div>
            <button type="button" class="btn btn-sm btn-secondary"
                    data-comment-id="${commentId}"
                    data-comment-content="${content}"
                    data-post-id="${postId}"
                    onclick="editComment(this)">âœï¸ ìˆ˜ì •</button>
            <form action="/posts/${postId}/comments/${commentId}/delete"
                  method="post" style="display: inline;">
                <input type="hidden" name="_method" value="delete" />
                <button type="submit" class="btn btn-sm btn-danger">ğŸ—‘ ì‚­ì œ</button>
            </form>
        </div>
    `;
}
</script>
</html>